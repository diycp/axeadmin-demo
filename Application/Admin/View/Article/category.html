<script type="text/javascript">
changeZtree(2);
function changeZtree(t) {
    var $panel = $.CurrentNavtab
    var $t     = $('#ztree1'),
        $span  = $('#ztree-'+ t),
        $log   = $('#ztree-log'),
        op     = $t.data()
    
    if (t != 7)
        $.fn.zTree.destroy('ztree1')

	var add    = op.addHoverDom ? null : 'edit',
		remove = op.removeHoverDom ? null : 'edit'
	
	$t.data('addHoverDom', add).data('removeHoverDom', remove)
	
	$log.val('data-add-hover-dom="'+ add +'"\r\n' + 'data-remove-hover-dom="'+ remove +'"')
	$span.text(($span.text() == '无') ? '显示' : '无')

    $panel.initui()
}
//单击事件
function ZtreeClick(event, treeId, treeNode) {
    event.preventDefault()
    
    var $detail = $('#ztree-detail')
    
    if ($detail.attr('tid') == treeNode.tId) return
	if (treeNode.name) $('#name').val(treeNode.name)
	if (treeNode.sort) {
		$('#sort').val(treeNode.sort)
	} else {
		$('#sort').val('0')
	}
	if (treeNode.id) {
		$('#id').val(treeNode.id)
	} else {
		$('#id').val('')
	}
	if (treeNode.parent_id) {
		$('#parent_id').val(treeNode.parent_id)
	} else {
		$('#parent_id').val('0')
	}	
	$detail.attr('tid', treeNode.tId)
    $detail.show()
}
//删除前事件
function M_BeforeRemove(treeId, treeNode) {
    var $log = $('#ztree-log')
    $log.val('准备删除：'+ treeNode.name +'！\n'+ $log.val())
    return true
}
//删除结束事件
function M_NodeRemove(event, treeId, treeNode) {
    var $log = $('#ztree-log')
    $log.val('删除成功！\n'+ $log.val())
}
</script>
<div class="bjui-pageContent">
    <div style="padding:20px;">
        <div class="clearfix">
            <div style="float:left; width:220px; overflow:auto;">
                <ul id="ztree1" class="ztree" data-toggle="ztree" 
                    data-options="{
                        expandAll: true,
                        onClick: 'ZtreeClick'
                    }"
                >
				<volist name="category" id="c">
					<li data-id="{$c.id}" data-sort="{$c.sort}" data-pid="{$c.parent_id}" <if condition="$c['parent_id'] eq 0 ">data-add-hover-dom="edit" data-remove-hover-dom="edit" </if>>{$c.name}</li>
				</volist>
                </ul>
            </div>
            <div id="ztree-detail" style="display:block; margin-left:230px; width:300px; height:240px;">
			<form action="{:U('Article/editcategory')}" data-toggle="validate">
                <div class="bs-example" data-content="详细信息">
					<input type="hidden" name="id" id="id" value="0" />
					<input type="hidden" name="parent_id" id="parent_id" value="0" />
                    <div class="form-group">
                        <label for="name" class="control-label x85">分类名称：</label>
                        <input type="text" class="form-control validate[required] required" data-rule="required" name="name" id="name" size="15" placeholder="分类名称" />
                    </div>
                    <div class="form-group">
                        <label for="sort" class="control-label x85">排序值：</label>
                        <input type="text" class="form-control" name="sort" id="sort" size="15" placeholder="排序值" />
                    </div>
                    <div class="form-group" style="padding-top:8px; border-top:1px #DDD solid;">
                        <label class="control-label x85"></label>
                        <button class="btn btn-green" type="submit">更新菜单</button>
                    </div>
                </div>
			</form>
            </div>
        </div>
    </div>
</div>